@import "mixins";

/*
 * This file exists solely for nasty browser hacks, fallbacks and fixes.
 *
 * It is envisaged that we DELETE the code-snippets as soon as support for each targeted browser is deprecated.
 * Therefore watch out for the «TARGETED BROWSER»-comments at the beginning of each function in this file.
 */




/*
 * TARGETED BROWSER: IE 11 and Edge <= 15
 *
 * This styles are needed for image--media-still classes on which the object-fit-fallback of srf-shame.js is applied.
 * Parents of elements with those classes usually restrict the aspect ratio of its box. Without the following rules
 * the height of the fallback-<div> would be 0.
 *
 */
.image--media-still,
.image--media-still-video {
  .js-fake-image-object-fit {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }
}
.teaser__medium-wrapper {
  .js-fake-image-object-fit {
    height: 100%;
    position: absolute;
  }
}
.image--media-still-dynamic {
  .js-fake-image-object-fit {
    height: 100%;
    position: relative;
  }
}
@media screen and (-ms-high-contrast: active), (-ms-high-contrast: none) {
  .teaser__medium-wrapper-xl-only {
    flex: 0 0 65.75%;
    .teaser__medium-wrapper {
      flex-basis: auto;
    }
  }
}

/*
 * TARGETED BROWSERS: ALL :(
 *
 * For iOS mobile devices we did some funky stuff with the <html> and <body> element (namely position: relative;) on
 * the body and position: fixed; on the menu on tablet-up. This results in wrong positioning of the Floating-Focus-Elem.
 * After the Header has been properly fixed, this can be removed.
 */
// sass-lint:disable no-ids
.menu--opened #flying-focus {
  margin-top: -56px;
}

@media (max-width: 719px) {
  .menu--opened #flying-focus {
    display: block;
    margin-top: 0;
  }
}
// sass-lint:enable no-ids


/*
 * TARGETED BROWSER: IE 11
 *
 * IE11 _sometimes_ has problems with scaled images with svg sources. The usual remedies (viewbox, no widths, etc.)
 * didn't help. This is the last resort - hiding the img and setting a background-image on the parent.
 */
.header-startlink--fixed-for-ie {
  width: 39px;
  height: 26px;
  background-image: url('../img/srf_logo_fallback.png');
  margin: 15px 16px;
  padding: 0;
}

.header-startlink--fixed-for-ie-rtr {
  background-image: url('../img/rtr_logo_fallback.png');
}

.header-startlink--fixed-for-ie .header-logo {
  display: none;
}



/*
 * TARGETED BROWSER: IE 11
 *
 * CSS Custom Properties double-fallbacks 'cause of IE 11 … why-oh-why do we still support Internet Explorer!?
 * Tell me, tell me now! Your arguments better be damn good!
 */
_:-ms-fullscreen,
:root .modal.modal--theme-dark .modal-main-wrapper {
  background-image: linear-gradient(135deg, #22211d, #111111);
  box-shadow: $shadow-elevation8;
}


/*
 * TARGETED BROWSER: IE 11
 *
 * overriding the img { height: auto } in _globals.scss because "IE will auto-scale the image area to keep the width:height
 * aspect ratio constant, but it won't scale the actual drawing to match the scale of the image dimensions.
 * see: https://css-tricks.com/scale-svg/#article-header-id-2
 */

@media screen and (-ms-high-contrast: active), (-ms-high-contrast: none) {
  .main-logo {
    img {
      height: 100%;
    }
  }
}


/*
 * TARGETED BROWSER: Safari
 *
 * Safari has troubles combining overflow-x: hidden and its own webkit-overflow-scrolling: touch.
 * This makes the 3rd-level-Navigation points not show up.
 */
.subnav--open-3rd-level {
  overflow-x: auto;

  .subnav__list {
    -webkit-overflow-scrolling: initial;
  }
}

/*
 * TARGETED BROWSER: Safari 10.*
 *
 * Mobile Safari on iOS 10.* does not trigger clicks on the Media elements.
 *
 * http://www.shdon.com/blog/2013/06/07/why-your-click-events-don-t-work-on-mobile-safari
 * > It does not generate click events for elements that do not have either or both of:
 * > - A directly bound onclick handler.
 * > - The cursor property set to pointer in CSS.
 */
.js-media {
  cursor: pointer;
}

/*
 * TARGETED BROWSER: IE 11
 *
 * IE11 does not support css custom properties.
 * Thats ok.
 * There are fallbacks in place.
 * And IE sucks anyway.
 * And IE users do not have to have the shiny modern web we all know and love.
 * But sometimes we need to have an extended fallback solution. Like, if you really have to see a theme (color or labeling/tagging) somehow in IE11.
 * THIS is for one of those times.
 */

.teaser__prekicker--fixed-for-ie {
  // 1st: Overwrite the "offscreen-non-focusable" mixin
  position: static;
  width: auto; // pretty cool but not IE: WebKit does have a -webkit-fit-content value for width, which would fix the full-width-problem
  height: auto;
  margin: 0;
  padding: 0;
  overflow: visible;
  clip: auto;
  border: 0;

  strong {
    // 2nd: Style to the max! (its pretty much a carbon copy of .teaser__live from teaser.scss)
    display: inline-block;
    margin: 0 8px 8px 0;
    padding: 2px 6px 0;
    background-color: $color-srf-light;
    font-family: $font-medium;
    font-weight: 500;
    font-style: normal;
    font-stretch: normal;
    color: #ffffff;
    text-transform: uppercase;
    @include font-smoothing;
    @include fontSize(12);
    line-height: $secondary-line-height-ratio;
  }
}

.teaser--size-m,
.teaser--size-l,
.teaser--size-xl {
  .teaser__prekicker--fixed-for-ie strong {
    @include tablet-up {
      @include fontSize(16);
    }
  }
}

/*
 * TARGETED BROWSER: IE 11
 *
 * removing blue bar on ie11's selected option within select menu (polis/chmap)
 */
.select-menu:focus::-ms-value {
  color: $color-text-accentuation;
  background-color: #cac8bf;
}

/*
 * TARGETED BROWSER: IE 11
 *
 * bottom and right borders (which are created by box-shadows) of collections and teasers are not rendered
 * properly in many cases. increasing the shadow blur solves it.
 */

@media screen and (-ms-high-contrast: active), (-ms-high-contrast: none) {
  .teaser,
  .collection__content-wrapper {
    box-shadow: 0 0 2px 0 rgba(0,0,0,0.16), 0 0 2px 0 rgba(0,0,0,0.08);
  }
}

/*
 * TARGETED BROWSER: IE 11
 *
 * IE11 does not know css custom properties - here are some fallback overrides
 */

@media screen and (-ms-high-contrast: active), (-ms-high-contrast: none) {
  .teaser--with-medium.teaser--size-s {
    .media-still__indicator {
      display: none;
    }
  }

  .teaser--with-medium.teaser--size-s-on-mobile {
    .media-still__indicator {
      @include smartphone {
        display: none;
      }
    }
  }

  .teaser--theme-dark {
    color: #ffffff;
    background-color: #22211d;

    &:after {
      background-color: rgba(255, 255, 255, .12);
    }

    .teaser__kicker {
      color: #dadad2;
    }

    .teaser__title,
    .teaser__lead,
    .teaser-info,
    .teaser-info--live-pre,
    .teaser-info--live-live,
    .teaser-info--new,
    .teaser-info--visited-and-recently-updated,
    .teaser-info--visited,
    .teaser-info--visited-and-updated,
    .teaser-info--mediaicon-video,
    .teaser-info--mediaicon-audio,
    .teaser-info--mediaicon-image,
    .teaser-info--media-caption {
      color: #ffffff;
    }
  }
  .teaser--longform {
    .block-link--internal.block-link--teaser-link {
      background-color: transparent;
      color: #FFF;
    }
    .teaser__longform-medium {
      .image--media-still-dynamic {
        height: 100%;
      }
    }
  }
}

/*
 * TARGETED BROWSER: Chrome and Firefox on macOS
 *
 * Changes subpixel anti-aliasing to normal antialiasing (font-smoothing) to themed modal Close-Button-Text
 * Safari already does this by default -> and on macOS Mojave subpixel anti-asliasing has been removed from the system entirely -> TODO: Let us remove font-smoothing globally when time comes.
 */
.modal.modal--theme-dark .icon-button {
  @include font-smoothing;
}

/*
 * TARGETED BROWSER: Firefox 52 - 60, IE11
 * Older browsers have troubles with the only working method we found for spanning
 * open the longform teasers. To prevent ugly hacks, we give them a min-height.
 */
.teaser--longform {
    &.teaser--size-m {
    @include smartphone {
      min-height: 289px;
    }
    @include tablet {
      min-height: 263px;
    }
    @include desktop {
      min-height: 299px;
    }
    @include desktop-wide {
      min-height: 374px;
    }
  }

  &.teaser--size-l {
    @include smartphone {
      min-height: 289px;
    }
    @include tablet {
      min-height: 308px;
    }
    @include desktop {
      min-height: 460px;
    }
    @include desktop-wide {
      min-height: 572px;
    }
  }

  &.teaser--size-xl {
    @include smartphone {
      min-height: 289px;
    }
    @include tablet {
      min-height: 237px;
    }
    @include desktop {
      min-height: 350px;
    }
    @include desktop-wide {
      min-height: 440px;
    }
  }
}

/**
 * TARGETED BROWSER: Firefox 52 but since that's not easily possible, we target FF < 57 here.
 * Old Firefox version (52) doesn't play nice with the ratio element and grid, which is used
 * in the XL teasers because of opinion/live center results elements.
 * Very sad. (⌯˃̶᷄ ﹏ ˂̶᷄⌯)
 */
@-moz-document url-prefix() {
  @supports not (animation: calc(0s)) {
    .teaser--size-xl .teaser__main {
      display: flex;

      .ratio-wrapper {
        height: auto;
      }
    }
  }
}

/*
 * TARGETED BROWSER: IE 11
 *
 * IE11 has troubles with flex-container in grid.
 */

@media screen and (-ms-high-contrast: active), (-ms-high-contrast: none) {
   .teaser__main-outer-wrapper {
     height: 100%;
   }
}

/*
 * TARGETED BROWSER: IE 11
 *
 * IE11 has troubles with animations :/ :/ :/
 */
@media screen and (-ms-high-contrast: active), (-ms-high-contrast: none) {
  .typeahead-suggestion {
    animation-name: nullAnimation;
    animation-delay: 0s;
    animation-duration: .1s;
    animation-fill-mode: forwards;
    max-height: none;
  }
}
